<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Identity Verification - Quant Invest</title>

  <!-- iOS-optimized Font Stack (System fonts + Inter fallback) -->
  <link rel="preconnect" href="https://rsms.me/">
  <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
  <link rel="stylesheet" href="../css/main.css">

</head>
<body class="bg-gray-50 font-sans">

  <main id="kyc-content" class="min-h-screen p-4 md:p-6">
    <!-- Content will be rendered here -->
  </main>

  <script type="module">
    import { getCurrentUser } from '../js/data.js';
    import { t } from '../js/i18n.js';

    const user = getCurrentUser();

    // Render KYC screen based on status
    function renderKYC() {
      const content = document.getElementById('kyc-content');

      // Determine status UI
      let statusHtml = '';
      let statusColor = '';
      let statusMessage = '';

      if (user.kycStatus === 'pending') {
        statusColor = 'text-yellow-600 bg-yellow-50 border-yellow-400';
        statusMessage = t('auth.kycPending');
        statusHtml = `
          <div class="flex items-center justify-center">
            <svg class="animate-spin h-12 w-12 text-yellow-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
          </div>
        `;
      } else if (user.kycStatus === 'approved') {
        statusColor = 'text-green-600 bg-green-50 border-green-400';
        statusMessage = t('auth.kycApproved');
        statusHtml = `
          <div class="flex items-center justify-center">
            <svg class="h-20 w-20 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </div>
        `;
      } else if (user.kycStatus === 'rejected') {
        statusColor = 'text-error bg-red-50 border-error';
        statusMessage = t('auth.kycRejected');
        statusHtml = `
          <div class="flex items-center justify-center">
            <svg class="h-20 w-20 text-error" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </div>
        `;
      } else {
        // Not submitted - show upload form
        content.innerHTML = `
          <div class="max-w-2xl mx-auto">
            <div class="bg-white rounded-lg shadow-xl p-8">
              <h1 class="text-2xl font-bold text-primary mb-6" id="kyc-title">${t('auth.kycTitle')}</h1>

              <form id="kyc-form" class="space-y-6">
                <div>
                  <label for="idType" class="block text-sm font-medium text-gray-700 mb-2">
                    Document Type
                  </label>
                  <select
                    id="idType"
                    name="idType"
                    required
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent focus:border-transparent"
                  >
                    <option value="">Select document type</option>
                    <option value="passport">Passport</option>
                    <option value="drivers-license">Driver's License</option>
                    <option value="national-id">National ID Card</option>
                  </select>
                </div>

                <div>
                  <label for="idNumber" class="block text-sm font-medium text-gray-700 mb-2">
                    Document Number
                  </label>
                  <input
                    type="text"
                    id="idNumber"
                    name="idNumber"
                    required
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent focus:border-transparent"
                    placeholder="Enter document number"
                  />
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    Upload Document (Front)
                  </label>
                  <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-accent transition-colors cursor-pointer">
                    <input type="file" id="docFront" name="docFront" accept="image/*,.pdf" class="hidden" required />
                    <label for="docFront" class="cursor-pointer">
                      <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                      </svg>
                      <p class="mt-2 text-sm text-gray-600">Click to upload or drag and drop</p>
                      <p class="text-xs text-gray-500">PNG, JPG, PDF up to 10MB</p>
                    </label>
                  </div>
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    Upload Document (Back)
                  </label>
                  <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-accent transition-colors cursor-pointer">
                    <input type="file" id="docBack" name="docBack" accept="image/*,.pdf" class="hidden" />
                    <label for="docBack" class="cursor-pointer">
                      <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                      </svg>
                      <p class="mt-2 text-sm text-gray-600">Click to upload or drag and drop</p>
                      <p class="text-xs text-gray-500">PNG, JPG, PDF up to 10MB</p>
                    </label>
                  </div>
                </div>

                <div class="bg-blue-50 border-l-4 border-blue-400 p-4">
                  <p class="text-sm text-blue-700">
                    Your information is encrypted and stored securely. We will verify your identity within 1-2 business days.
                  </p>
                </div>

                <button
                  type="submit"
                  class="w-full px-6 py-3 bg-accent text-white font-semibold rounded-lg hover:bg-accent/90 focus:outline-none focus:ring-2 focus:ring-accent transition-colors"
                >
                  Submit for Verification
                </button>
              </form>
            </div>
          </div>
        `;

        // Attach form handler
        document.getElementById('kyc-form').addEventListener('submit', (e) => {
          e.preventDefault();
          alert('KYC documents submitted! Redirecting to dashboard...');
          window.location.hash = '#/dashboard';
        });

        return;
      }

      // Render status screen
      content.innerHTML = `
        <div class="max-w-2xl mx-auto flex items-center justify-center min-h-screen">
          <div class="bg-white rounded-lg shadow-xl p-12 text-center">
            <h1 class="text-2xl font-bold text-primary mb-8">${t('auth.kycTitle')}</h1>

            ${statusHtml}

            <div class="mt-8 p-4 rounded-lg border-4 ${statusColor}">
              <p class="text-lg font-semibold">${statusMessage}</p>
            </div>

            ${user.kycStatus === 'approved' ? `
              <div class="mt-8">
                <a href="#/dashboard" class="inline-block px-6 py-3 bg-accent text-white font-semibold rounded-lg hover:bg-accent/90 focus:outline-none focus:ring-2 focus:ring-accent transition-colors">
                  Go to Dashboard
                </a>
              </div>
            ` : ''}

            ${user.kycStatus === 'rejected' ? `
              <div class="mt-8">
                <button onclick="location.reload()" class="inline-block px-6 py-3 bg-accent text-white font-semibold rounded-lg hover:bg-accent/90 focus:outline-none focus:ring-2 focus:ring-accent transition-colors">
                  Resubmit Documents
                </button>
              </div>
            ` : ''}
          </div>
        </div>
      `;
    }

    // Listen for language changes
    window.addEventListener('languagechange', () => {
      location.reload();
    });

    // Render on load
    renderKYC();
  </script>
</body>
</html>
